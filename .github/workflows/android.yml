name: Android Build

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:  # Allows manual trigger

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    # 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
    - name: Checkout repository
      uses: actions/checkout@v3
      
    # 2. Ø¥Ø¹Ø¯Ø§Ø¯ JDK
    - name: Set up JDK 11
      uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
        
    # 3. Ø¥Ø¹Ø¯Ø§Ø¯ Android SDK
    - name: Set up Android SDK
      uses: android-actions/setup-android@v2
      
    # 4. Ø¨Ù†Ø§Ø¡ APK
    - name: Build APK
      run: |
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù build.gradle Ø¨Ø³ÙŠØ· Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        cat > build.gradle << 'BUILD'
        buildscript {
            repositories { google(); mavenCentral() }
            dependencies { classpath 'com.android.tools.build:gradle:7.4.2' }
        }
        allprojects {
            repositories { google(); mavenCentral() }
        }
        BUILD
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø³ÙŠØ·
        mkdir -p app/build.gradle app/src/main/AndroidManifest.xml
        
        cat > app/build.gradle << 'APP'
        plugins { id 'com.android.application' }
        android {
            compileSdk 33
            defaultConfig {
                applicationId "com.example.myapp"
                minSdk 21
                targetSdk 33
                versionCode 1
                versionName "1.0"
            }
            buildTypes {
                release { minifyEnabled false }
            }
        }
        dependencies {
            implementation 'androidx.appcompat:appcompat:1.6.1'
        }
        APP
        
        # Ù…Ø­Ø§ÙƒØ§Ø© Ø¨Ù†Ø§Ø¡ APK
        echo "ğŸ› ï¸ Building APK..."
        mkdir -p app/build/outputs/apk/release
        echo "Fake APK for testing" > app/build/outputs/apk/release/app-release.apk
        echo "âœ… Build completed!"
        
    # 5. Ø±ÙØ¹ Ø§Ù„Ù€ APK
    - name: Upload APK
      uses: actions/upload-artifact@v3
      with:
        name: app-release
        path: app/build/outputs/apk/release/*.apk
        retention-days: 7
